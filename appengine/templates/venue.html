{% extends "base.html" %}
{% set css_name = "css/model.css" %}
{% block content %}

    <div class = "results"></div>
    <script>
      var result = "";
      var parameters = location.search.substring(1);

      var temp = parameters.split("=");
      name = decodeURI(temp[1]);
      result = "<h1>" + name + "</h1>";

      var iframe = document.createElement('iframe');
      iframe.id = 'iframe';
      iframe.style.display = 'none';
      document.body.appendChild(iframe);
      iframe.src = 'static/JSONs/venues.json';

      var iframe2 = document.createElement('iframe');
      iframe2.id = 'iframe2';
      iframe2.style.display = 'none';
      document.body.appendChild(iframe2);
      iframe2.src = 'static/JSONs/works.json';

      var json;
      var json2;

      setTimeout(function() {
        var venues = document.getElementById('iframe').contentDocument.body.firstChild.innerHTML;
        json = JSON.parse(venues);

        var works = document.getElementById('iframe2').contentDocument.body.firstChild.innerHTML;
        json2 = JSON.parse(works);

        for (var key in json) {
          var val = json[key];
          for(var key2 in val) {
            var obj = val[key2];
            if(obj.name === name) {
              result += obj.city + "<br>";
              result += obj.country + "<br>";
              result += obj.address + "<br>";
              result += "<h2>Works</h2><br>";
              for(var i in json2) {
                var val2 = json2[i];
                for(var j in val2) {
                  var work = val2[j];
                  if(obj.work_ids.includes(work.work_id)) {
                    result += "<a href=work?name=" + encodeURI(work.name) + ">" + work.name + "</a><br><br>";
                  }
                }
              }
            }
          }
        }
        document.querySelector('.results').innerHTML = result;
      }, 500);
    </script>

{% endblock %}
